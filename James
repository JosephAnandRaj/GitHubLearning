Code changes done by James
