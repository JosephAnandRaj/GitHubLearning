Code changes done by joseph